p(a, f(T, b), M):-
  q(Y, M, a),
  r(T, Q).

p(a, b, 3).
q(c, c, a).

q(X, c, a):-
  r(g(a, X), d).
r(f(b,a),d).
r(g(a,t),d).